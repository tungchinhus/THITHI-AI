<div class="flex flex-col h-screen bg-white font-sans">
  <!-- Header -->
  <header 
    class="bg-indigo-600 text-white shadow-md flex items-center justify-between sticky top-0 z-10"
    style="background-color: #4f46e5; padding: 0.75rem 1rem; min-height: 60px;"
  >
    <!-- Left: Robot Icon + Title -->
    <div class="flex items-center" style="display: flex; align-items: center; gap: 0.75rem;">
      <!-- Small Robot Icon -->
      <div style="width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center;">
        <svg viewBox="0 0 100 100" style="width: 2.5rem; height: 2.5rem; fill: #000000;" xmlns="http://www.w3.org/2000/svg">
          <!-- Robot Head (Square) -->
          <rect x="25" y="20" width="50" height="50" rx="5" fill="#000000"/>
          <!-- Left Eye -->
          <circle cx="38" cy="38" r="4" fill="#ffffff"/>
          <!-- Right Eye -->
          <circle cx="62" cy="38" r="4" fill="#ffffff"/>
          <!-- Mouth (Happy curve) -->
          <path d="M 38 52 Q 50 48 62 52" stroke="#ffffff" stroke-width="2" fill="none" stroke-linecap="round"/>
          <!-- Left Ear -->
          <rect x="15" y="30" width="12" height="30" rx="2" fill="#000000"/>
          <!-- Right Ear -->
          <rect x="73" y="30" width="12" height="30" rx="2" fill="#000000"/>
          <!-- Top Circle -->
          <circle cx="50" cy="12" r="6" fill="#000000"/>
        </svg>
      </div>
      
      <!-- Title and Status -->
      <div>
        <h1 class="font-bold" style="font-size: 1rem; font-weight: 700; line-height: 1.2; margin: 0;">Trợ lý THIBIDI</h1>
        <p class="flex items-center" style="font-size: 0.75rem; display: flex; align-items: center; margin: 0; margin-top: 0.125rem;">
          <span style="width: 0.375rem; height: 0.375rem; background-color: #34d399; border-radius: 50%; margin-right: 0.375rem; display: inline-block;"></span>
          Trực tuyến
        </p>
      </div>
    </div>
    
    <!-- Right: Menu Button -->
    <button 
      class="text-white hover:bg-white/10 p-2 rounded-full transition-colors"
      style="color: #ffffff; padding: 0.5rem; border-radius: 50%; border: none; background: transparent; cursor: pointer;"
      aria-label="Menu"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 1.5rem; height: 1.5rem;">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
      </svg>
    </button>
  </header>

  <!-- Chat Messages Area -->
  <main 
    #messagesContainer
    class="flex-1 overflow-y-auto p-4 scroll-smooth"
    style="background-color: #ffffff; padding-bottom: 1rem;"
  >
    <!-- Messages -->
    <div *ngFor="let message of messages" class="flex items-end mb-4" [ngClass]="message.role === 'user' ? 'justify-end' : 'justify-start'" style="margin-bottom: 1rem;">
      
      <!-- Bot Message -->
      <div *ngIf="message.role === 'assistant'" class="flex items-end">
        <!-- Bot Avatar - Small Robot Icon -->
        <div 
          class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-2"
          style="width: 2rem; height: 2rem; border-radius: 50%; background-color: #e0e7ff; border: 1px solid #c7d2fe; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-right: 0.5rem;"
        >
          <svg viewBox="0 0 100 100" class="w-5 h-5" style="width: 1.25rem; height: 1.25rem; fill: #000000;" xmlns="http://www.w3.org/2000/svg">
            <!-- Robot Head (Square) -->
            <rect x="25" y="20" width="50" height="50" rx="5" fill="#000000"/>
            <!-- Left Eye -->
            <circle cx="38" cy="38" r="4" fill="#ffffff"/>
            <!-- Right Eye -->
            <circle cx="62" cy="38" r="4" fill="#ffffff"/>
            <!-- Mouth (Sad curve) -->
            <path d="M 38 52 Q 50 58 62 52" stroke="#ffffff" stroke-width="2" fill="none" stroke-linecap="round"/>
            <!-- Left Ear -->
            <rect x="15" y="30" width="12" height="30" rx="2" fill="#000000"/>
            <!-- Right Ear -->
            <rect x="73" y="30" width="12" height="30" rx="2" fill="#000000"/>
            <!-- Top Circle -->
            <circle cx="50" cy="12" r="6" fill="#000000"/>
          </svg>
        </div>
        
        <!-- Bot Message Bubble -->
        <div 
          style="background-color: #f3f4f6; color: #1f2937; border-radius: 1rem 1rem 1rem 0; padding: 0.625rem 1rem; max-width: 85%; word-wrap: break-word;"
        >
          <p 
            class="text-sm md:text-base leading-relaxed whitespace-pre-wrap"
            style="font-size: 0.875rem; line-height: 1.5; white-space: pre-wrap; margin: 0;"
          >
            {{ message.content }}
          </p>
          <div 
            class="text-[10px] mt-1 text-right"
            style="font-size: 0.625rem; margin-top: 0.25rem; text-align: right; color: #9ca3af;"
            *ngIf="message.timestamp"
          >
            {{ message.timestamp | date:'HH:mm' }}
          </div>
        </div>
      </div>

      <!-- User Message -->
      <div *ngIf="message.role === 'user'" class="flex items-end">
        <!-- User Message Bubble -->
        <div 
          style="background-color: #4f46e5; color: #ffffff; border-radius: 1rem 1rem 0 1rem; padding: 0.625rem 1rem; max-width: 85%; word-wrap: break-word;"
        >
          <p 
            class="text-sm md:text-base leading-relaxed whitespace-pre-wrap"
            style="font-size: 0.875rem; line-height: 1.5; white-space: pre-wrap; margin: 0;"
          >
            {{ message.content }}
          </p>
          <div 
            class="text-[10px] mt-1 text-right"
            style="font-size: 0.625rem; margin-top: 0.25rem; text-align: right; color: rgba(255, 255, 255, 0.7);"
            *ngIf="message.timestamp"
          >
            {{ message.timestamp | date:'HH:mm' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div *ngIf="isLoading" class="flex justify-start items-end mb-4" style="display: flex; justify-content: flex-start; align-items: flex-end; margin-bottom: 1rem;">
      <div 
        class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-2"
        style="width: 2rem; height: 2rem; border-radius: 50%; background-color: #e0e7ff; border: 1px solid #c7d2fe; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-right: 0.5rem;"
      >
        <svg viewBox="0 0 100 100" class="w-5 h-5" style="width: 1.25rem; height: 1.25rem; fill: #000000;" xmlns="http://www.w3.org/2000/svg">
          <!-- Robot Head (Square) -->
          <rect x="25" y="20" width="50" height="50" rx="5" fill="#000000"/>
          <!-- Left Eye -->
          <circle cx="38" cy="38" r="4" fill="#ffffff"/>
          <!-- Right Eye -->
          <circle cx="62" cy="38" r="4" fill="#ffffff"/>
          <!-- Mouth (Sad curve) -->
          <path d="M 38 52 Q 50 58 62 52" stroke="#ffffff" stroke-width="2" fill="none" stroke-linecap="round"/>
          <!-- Left Ear -->
          <rect x="15" y="30" width="12" height="30" rx="2" fill="#000000"/>
          <!-- Right Ear -->
          <rect x="73" y="30" width="12" height="30" rx="2" fill="#000000"/>
          <!-- Top Circle -->
          <circle cx="50" cy="12" r="6" fill="#000000"/>
        </svg>
      </div>
      <div 
        class="px-4 py-3 rounded-2xl rounded-tl-none flex space-x-1"
        style="background-color: #f3f4f6; padding: 0.75rem 1rem; border-radius: 1rem 1rem 1rem 0; display: flex; gap: 0.25rem;"
      >
        <div class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce" style="width: 0.375rem; height: 0.375rem; background-color: #818cf8; border-radius: 50%;"></div>
        <div class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce" style="width: 0.375rem; height: 0.375rem; background-color: #818cf8; border-radius: 50%; animation-delay: 0.2s;"></div>
        <div class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce" style="width: 0.375rem; height: 0.375rem; background-color: #818cf8; border-radius: 50%; animation-delay: 0.4s;"></div>
      </div>
    </div>
  </main>

  <!-- Input Area - Fixed at Bottom -->
  <footer 
    class="bg-white border-t"
    style="background-color: #ffffff; border-top: 1px solid #e5e7eb; position: sticky; bottom: 0; z-index: 10; width: 100%;"
  >
    <form (ngSubmit)="sendMessage()" style="width: 100%; padding: 0.75rem; box-sizing: border-box;">
      <div style="display: flex; align-items: flex-end; gap: 0.5rem; width: 100%;">
        <div 
          class="flex-1 rounded-2xl px-4 py-2"
          style="flex: 1; background-color: #f3f4f6; border-radius: 1rem; padding: 0.5rem 1rem; width: 100%;"
        >
          <textarea
            #messageInput
            [(ngModel)]="currentMessage"
            (keydown)="onEnterKey($event)"
            (input)="adjustTextareaHeight()"
            name="messageInput"
            rows="1"
            placeholder="Nhập tin nhắn..."
            class="w-full bg-transparent border-none py-1 resize-none max-h-32 text-base outline-none"
            style="width: 100%; background: transparent; border: none; padding: 0.25rem 0; resize: none; max-height: 8rem; font-size: 1rem; outline: none; color: #1f2937; box-sizing: border-box;"
            [disabled]="isLoading"
          ></textarea>
        </div>
        
        <!-- Right side: Icons + Send Button -->
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; flex-shrink: 0;">
          <!-- Three dots menu icon -->
          <button 
            type="button"
            class="p-2 rounded-full hover:bg-gray-100 transition-colors"
            style="padding: 0.5rem; border-radius: 50%; border: none; background: transparent; cursor: pointer; color: #6b7280; display: flex; align-items: center; justify-content: center;"
            aria-label="More options"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 1.25rem; height: 1.25rem;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
            </svg>
          </button>
          
          <!-- Microphone/Voice Input Button -->
          <button 
            type="button"
            (click)="toggleRecording()"
            [disabled]="!isSpeechSupported || isLoading"
            class="p-2 rounded-full transition-colors"
            [ngStyle]="{
              'padding': '0.5rem',
              'border-radius': '50%',
              'border': 'none',
              'background': isRecording ? '#fee2e2' : 'transparent',
              'cursor': (!isSpeechSupported || isLoading) ? 'not-allowed' : 'pointer',
              'color': isRecording ? '#dc2626' : '#6b7280',
              'display': 'flex',
              'align-items': 'center',
              'justify-content': 'center',
              'opacity': (!isSpeechSupported || isLoading) ? '0.5' : '1'
            }"
            [title]="isRecording ? 'Dừng ghi âm (Click để dừng)' : (isSpeechSupported ? 'Bắt đầu ghi âm (Click để nói)' : 'Trình duyệt không hỗ trợ nhận diện giọng nói')"
            aria-label="Ghi âm giọng nói"
          >
            <svg *ngIf="!isRecording" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 1.25rem; height: 1.25rem;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
            <svg *ngIf="isRecording" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24" style="width: 1.25rem; height: 1.25rem;">
              <rect x="6" y="6" width="12" height="12" rx="2"/>
            </svg>
          </button>
          
          <!-- Send Button -->
          <button 
            type="submit"
            [disabled]="!currentMessage.trim() || isLoading"
            class="p-3 rounded-full flex-shrink-0"
            style="background-color: #4f46e5; color: #ffffff; padding: 0.75rem; border-radius: 50%; border: none; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; min-width: 3rem; min-height: 3rem;"
            [style.opacity]="(!currentMessage.trim() || isLoading) ? '0.5' : '1'"
            [style.cursor]="(!currentMessage.trim() || isLoading) ? 'not-allowed' : 'pointer'"
            aria-label="Gửi tin nhắn"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 1.25rem; height: 1.25rem;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
            </svg>
          </button>
        </div>
      </div>
    </form>
    
    <!-- Recording Indicator -->
    <div *ngIf="isRecording" class="max-w-4xl mx-auto mt-2 flex items-center justify-center" style="max-width: 56rem; margin: 0 auto; margin-top: 0.5rem; display: flex; align-items: center; justify-content: center;">
      <div class="flex items-center space-x-2 px-3 py-1.5 bg-red-50 rounded-full border border-red-200" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background-color: #fef2f2; border-radius: 9999px; border: 1px solid #fecaca;">
        <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse" style="width: 0.5rem; height: 0.5rem; background-color: #ef4444; border-radius: 50%;"></div>
        <span class="text-xs font-medium text-red-600" style="font-size: 0.75rem; font-weight: 500; color: #dc2626;">Đang ghi âm...</span>
      </div>
    </div>
  </footer>
</div>
