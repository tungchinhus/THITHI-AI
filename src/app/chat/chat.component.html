<div class="flex flex-col h-screen bg-white font-sans">
  <!-- Header -->
  <header 
    class="bg-indigo-600 text-white shadow-md flex items-center justify-between sticky top-0 z-10"
    style="background-color: #4f46e5; padding: 0.75rem 1rem; min-height: 60px; display: flex; align-items: center; justify-content: space-between; width: 100%;"
  >
    <!-- Left: Robot Icon + Title + Navigation -->
    <div class="flex items-center" style="display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0;">
      <!-- Small Robot Icon -->
      <div style="width: 2.5rem; height: 2.5rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
        <svg viewBox="0 0 100 100" style="width: 2.5rem; height: 2.5rem;" xmlns="http://www.w3.org/2000/svg">
          <!-- Robot Head (Square) - Pink -->
          <rect x="25" y="20" width="50" height="50" rx="5" fill="#ec4899"/>
          <!-- Left Eye - White -->
          <circle cx="38" cy="38" r="5" fill="#ffffff"/>
          <!-- Right Eye - White -->
          <circle cx="62" cy="38" r="5" fill="#ffffff"/>
          <!-- Eye pupils - Pink -->
          <circle cx="38" cy="38" r="2.5" fill="#ec4899"/>
          <circle cx="62" cy="38" r="2.5" fill="#ec4899"/>
          <!-- Mouth (Happy smile) - White -->
          <path d="M 35 55 Q 50 62 65 55" stroke="#ffffff" stroke-width="3" fill="none" stroke-linecap="round"/>
          <!-- Left Ear - Pink -->
          <rect x="15" y="30" width="12" height="30" rx="2" fill="#ec4899"/>
          <!-- Right Ear - Pink -->
          <rect x="73" y="30" width="12" height="30" rx="2" fill="#ec4899"/>
          <!-- Top Circle - Pink -->
          <circle cx="50" cy="12" r="6" fill="#ec4899"/>
          <!-- Cheeks - Light pink for cuteness -->
          <circle cx="20" cy="45" r="4" fill="#fce7f3" opacity="0.8"/>
          <circle cx="80" cy="45" r="4" fill="#fce7f3" opacity="0.8"/>
        </svg>
      </div>
      
      <!-- Title and Status -->
      <div style="flex-shrink: 0;">
        <h1 class="font-bold" style="font-size: 1rem; font-weight: 700; line-height: 1.2; margin: 0;">{{ botName }}</h1>
        <p class="flex items-center" style="font-size: 0.75rem; display: flex; align-items: center; margin: 0; margin-top: 0.125rem;">
          <span style="width: 0.375rem; height: 0.375rem; background-color: #34d399; border-radius: 50%; margin-right: 0.375rem; display: inline-block;"></span>
          Tr·ª±c tuy·∫øn
        </p>
      </div>

      <!-- Navigation Links -->
      <div *ngIf="false" class="flex items-center gap-2 ml-4" style="display: flex; align-items: center; gap: 0.5rem; margin-left: 1rem;">
        <a
          routerLink="/import"
          routerLinkActive="bg-indigo-700"
          class="px-3 py-1.5 rounded-md text-sm font-medium transition-colors"
          style="padding: 0.375rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 500; background-color: rgba(255, 255, 255, 0.15); color: #ffffff; border: 1px solid rgba(255, 255, 255, 0.3); cursor: pointer; transition: all 0.2s; text-decoration: none;"
          title="Import Excel"
        >
          üìä Import Excel
        </a>
      </div>
    </div>
    
    <!-- Right: Login/User Info - Hidden -->
    
  </header>

  <!-- Chat Messages Area -->
  <main 
    #messagesContainer
    class="flex-1 overflow-y-auto p-4 scroll-smooth"
    style="background-color: #ffffff; padding-left: 0.75rem; padding-right: 0.75rem; padding-bottom: calc(1rem + 120px);"
  >
    <!-- Messages -->
    <div *ngFor="let message of messages" class="flex items-end mb-4" [ngClass]="message.role === 'user' ? 'justify-end' : 'justify-start'" style="margin-bottom: 1rem;">
      
      <!-- Bot Message -->
      <div *ngIf="message.role === 'assistant'" class="flex items-start">
        <!-- Bot Avatar - Small Robot Icon -->
        <div 
          class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-2"
          style="width: 2rem; height: 2rem; border-radius: 50%; background-color: #fce7f3; border: 1px solid #f9a8d4; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-right: 0.5rem; margin-top: 0.25rem;"
        >
          <svg viewBox="0 0 100 100" class="w-5 h-5" style="width: 1.25rem; height: 1.25rem;" xmlns="http://www.w3.org/2000/svg">
            <!-- Robot Head (Square) - Pink -->
            <rect x="25" y="20" width="50" height="50" rx="5" fill="#ec4899"/>
            <!-- Left Eye - White -->
            <circle cx="38" cy="38" r="5" fill="#ffffff"/>
            <!-- Right Eye - White -->
            <circle cx="62" cy="38" r="5" fill="#ffffff"/>
            <!-- Eye pupils - Pink -->
            <circle cx="38" cy="38" r="2.5" fill="#ec4899"/>
            <circle cx="62" cy="38" r="2.5" fill="#ec4899"/>
            <!-- Mouth (Happy smile) - White -->
            <path d="M 35 55 Q 50 62 65 55" stroke="#ffffff" stroke-width="3" fill="none" stroke-linecap="round"/>
            <!-- Left Ear - Pink -->
            <rect x="15" y="30" width="12" height="30" rx="2" fill="#ec4899"/>
            <!-- Right Ear - Pink -->
            <rect x="73" y="30" width="12" height="30" rx="2" fill="#ec4899"/>
            <!-- Top Circle - Pink -->
            <circle cx="50" cy="12" r="6" fill="#ec4899"/>
            <!-- Cheeks - Light pink for cuteness -->
            <circle cx="20" cy="45" r="4" fill="#fce7f3" opacity="0.8"/>
            <circle cx="80" cy="45" r="4" fill="#fce7f3" opacity="0.8"/>
          </svg>
        </div>
        
        <!-- Bot Message Bubble -->
        <div 
          style="background-color: #f3f4f6; color: #1f2937; border-radius: 1rem 1rem 1rem 0; padding: 0.625rem 1rem; max-width: 85%; word-wrap: break-word;"
        >
          <!-- Message Content (Markdown) -->
          <div 
            class="text-sm md:text-base leading-relaxed"
            style="font-size: 0.875rem; line-height: 1.5; margin: 0;"
            markdown
            [data]="message.content"
          ></div>
          
          <!-- Citations/Sources -->
          <div *ngIf="message.citations && message.citations.length > 0" 
            style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #e5e7eb;"
          >
            <p style="font-size: 0.75rem; color: #6b7280; margin: 0 0 0.25rem 0; font-weight: 500;">Ngu·ªìn tham kh·∫£o:</p>
            <ul style="list-style: none; padding: 0; margin: 0;">
              <li *ngFor="let citation of message.citations" 
                style="font-size: 0.75rem; color: #4f46e5; margin: 0.125rem 0;"
              >
                ‚Ä¢ {{ citation }}
              </li>
            </ul>
          </div>
          
          <!-- Suggestions -->
          <div *ngIf="message.suggestions && message.suggestions.length > 0" 
            style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #e5e7eb;"
          >
            <p style="font-size: 0.75rem; color: #6b7280; margin: 0 0 0.5rem 0; font-weight: 500;">G·ª£i √Ω:</p>
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
              <button
                *ngFor="let suggestion of message.suggestions"
                (click)="handleSuggestionClick(suggestion)"
                [disabled]="isLoading"
                type="button"
                style="
                  padding: 0.375rem 0.75rem;
                  border-radius: 0.5rem;
                  font-size: 0.75rem;
                  background-color: #ffffff;
                  color: #4f46e5;
                  border: 1px solid #c7d2fe;
                  cursor: pointer;
                  transition: all 0.2s;
                  white-space: nowrap;
                "
                [style.opacity]="isLoading ? '0.5' : '1'"
                [style.cursor]="isLoading ? 'not-allowed' : 'pointer'"
                [style.background-color]="isLoading ? '#f3f4f6' : '#ffffff'"
                [style.border-color]="isLoading ? '#e5e7eb' : '#c7d2fe'"
                onmouseover="if (!this.disabled) { this.style.backgroundColor='#eef2ff'; this.style.borderColor='#818cf8'; }"
                onmouseout="if (!this.disabled) { this.style.backgroundColor='#ffffff'; this.style.borderColor='#c7d2fe'; }"
                [title]="'Click ƒë·ªÉ h·ªèi: ' + suggestion"
              >
                üí° {{ suggestion }}
              </button>
            </div>
          </div>
          
          <!-- Timestamp -->
          <div 
            class="text-[10px] mt-1 text-right"
            style="font-size: 0.625rem; margin-top: 0.25rem; text-align: right; color: #9ca3af;"
            *ngIf="message.timestamp"
          >
            {{ message.timestamp | date:'HH:mm' }}
          </div>
        </div>
      </div>

      <!-- User Message -->
      <div *ngIf="message.role === 'user'" class="flex items-end">
        <!-- User Message Bubble -->
        <div 
          style="background-color: #4f46e5; color: #ffffff; border-radius: 1rem 1rem 0 1rem; padding: 0.625rem 1rem; max-width: 85%; word-wrap: break-word;"
        >
          <p 
            class="text-sm md:text-base leading-relaxed whitespace-pre-wrap"
            style="font-size: 0.875rem; line-height: 1.5; white-space: pre-wrap; margin: 0;"
          >
            {{ message.content }}
          </p>
          <div 
            class="text-[10px] mt-1 text-right"
            style="font-size: 0.625rem; margin-top: 0.25rem; text-align: right; color: rgba(255, 255, 255, 0.7);"
            *ngIf="message.timestamp"
          >
            {{ message.timestamp | date:'HH:mm' }}
          </div>
        </div>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div *ngIf="isLoading" class="flex justify-start items-start mb-4" style="display: flex; justify-content: flex-start; align-items: flex-start; margin-bottom: 1rem;">
      <div 
        class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-2"
        style="width: 2rem; height: 2rem; border-radius: 50%; background-color: #fce7f3; border: 1px solid #f9a8d4; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-right: 0.5rem; margin-top: 0.25rem;"
      >
        <svg viewBox="0 0 100 100" class="w-5 h-5" style="width: 1.25rem; height: 1.25rem;" xmlns="http://www.w3.org/2000/svg">
          <!-- Robot Head (Square) - Pink -->
          <rect x="25" y="20" width="50" height="50" rx="5" fill="#ec4899"/>
          <!-- Left Eye - White -->
          <circle cx="38" cy="38" r="5" fill="#ffffff"/>
          <!-- Right Eye - White -->
          <circle cx="62" cy="38" r="5" fill="#ffffff"/>
          <!-- Eye pupils - Pink -->
          <circle cx="38" cy="38" r="2.5" fill="#ec4899"/>
          <circle cx="62" cy="38" r="2.5" fill="#ec4899"/>
          <!-- Mouth (Happy smile) - White -->
          <path d="M 35 55 Q 50 62 65 55" stroke="#ffffff" stroke-width="3" fill="none" stroke-linecap="round"/>
          <!-- Left Ear - Pink -->
          <rect x="15" y="30" width="12" height="30" rx="2" fill="#ec4899"/>
          <!-- Right Ear - Pink -->
          <rect x="73" y="30" width="12" height="30" rx="2" fill="#ec4899"/>
          <!-- Top Circle - Pink -->
          <circle cx="50" cy="12" r="6" fill="#ec4899"/>
          <!-- Cheeks - Light pink for cuteness -->
          <circle cx="20" cy="45" r="4" fill="#fce7f3" opacity="0.8"/>
          <circle cx="80" cy="45" r="4" fill="#fce7f3" opacity="0.8"/>
        </svg>
      </div>
      <div 
        class="px-4 py-3 rounded-2xl rounded-tl-none"
        style="background-color: #f3f4f6; padding: 0.75rem 1rem; border-radius: 1rem 1rem 1rem 0;"
      >
        <span style="font-size: 0.875rem; color: #6b7280;">ƒêang suy nghƒ©...</span>
      </div>
    </div>
  </main>

  <!-- Input Area - Fixed at Bottom -->
  <footer 
    class="bg-white border-t"
    style="background-color: #ffffff; border-top: 1px solid #e5e7eb; position: fixed; bottom: 0; left: 0; right: 0; z-index: 1000; width: 100%; box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);"
  >
    <form (ngSubmit)="sendMessage()" style="width: 100%; padding: 0.75rem; box-sizing: border-box;">
      <div style="display: flex; align-items: flex-end; gap: 0.5rem; width: 100%;">
        <div 
          class="flex-1 rounded-2xl px-4 py-2"
          style="flex: 1; background-color: #f3f4f6; border-radius: 1rem; padding: 0.5rem 1rem; width: 100%;"
        >
          <textarea
            #messageInput
            [(ngModel)]="currentMessage"
            (keydown)="onEnterKey($event)"
            (input)="adjustTextareaHeight()"
            name="messageInput"
            rows="1"
            placeholder="Nh·∫≠p tin nh·∫Øn..."
            class="w-full bg-transparent border-none py-1 resize-none max-h-32 text-base outline-none"
            style="width: 100%; background: transparent; border: none; padding: 0.25rem 0; resize: none; max-height: 8rem; font-size: 1rem; outline: none; color: #1f2937; box-sizing: border-box;"
            [disabled]="isLoading"
          ></textarea>
        </div>
        
        <!-- Right side: Icons + Send Button -->
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; flex-shrink: 0;">
         
          <!-- Microphone/Voice Input Button -->
          <button 
            type="button"
            (click)="toggleRecording()"
            [disabled]="!isSpeechSupported || isLoading"
            class="p-2 rounded-full transition-colors"
            [ngStyle]="{
              'padding': '0.5rem',
              'border-radius': '50%',
              'border': 'none',
              'background': isRecording ? '#fee2e2' : 'transparent',
              'cursor': (!isSpeechSupported || isLoading) ? 'not-allowed' : 'pointer',
              'color': isRecording ? '#dc2626' : '#6b7280',
              'display': 'flex',
              'align-items': 'center',
              'justify-content': 'center',
              'opacity': (!isSpeechSupported || isLoading) ? '0.5' : '1'
            }"
            [title]="isRecording ? 'D·ª´ng ghi √¢m (Click ƒë·ªÉ d·ª´ng)' : (isSpeechSupported ? 'B·∫Øt ƒë·∫ßu ghi √¢m (Click ƒë·ªÉ n√≥i)' : 'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ nh·∫≠n di·ªán gi·ªçng n√≥i')"
            aria-label="Ghi √¢m gi·ªçng n√≥i"
          >
            <svg *ngIf="!isRecording" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 1.25rem; height: 1.25rem;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
            <svg *ngIf="isRecording" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24" style="width: 1.25rem; height: 1.25rem;">
              <rect x="6" y="6" width="12" height="12" rx="2"/>
            </svg>
          </button>
          
          <!-- Send Button -->
          <button 
            type="submit"
            [disabled]="!currentMessage.trim() || isLoading"
            class="p-3 rounded-full flex-shrink-0"
            style="background-color: #4f46e5; color: #ffffff; padding: 0.75rem; border-radius: 50%; border: none; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; min-width: 3rem; min-height: 3rem;"
            [style.opacity]="(!currentMessage.trim() || isLoading) ? '0.5' : '1'"
            [style.cursor]="(!currentMessage.trim() || isLoading) ? 'not-allowed' : 'pointer'"
            aria-label="G·ª≠i tin nh·∫Øn"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 1.25rem; height: 1.25rem;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
            </svg>
          </button>
        </div>
      </div>
    </form>
    
    <!-- Recording Indicator -->
    <div *ngIf="isRecording" class="max-w-4xl mx-auto mt-2 flex items-center justify-center" style="max-width: 56rem; margin: 0 auto; margin-top: 0.5rem; display: flex; align-items: center; justify-content: center;">
      <div class="flex items-center space-x-2 px-3 py-1.5 bg-red-50 rounded-full border border-red-200" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background-color: #fef2f2; border-radius: 9999px; border: 1px solid #fecaca;">
        <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse" style="width: 0.5rem; height: 0.5rem; background-color: #ef4444; border-radius: 50%;"></div>
        <span class="text-xs font-medium text-red-600" style="font-size: 0.75rem; font-weight: 500; color: #dc2626;">ƒêang ghi √¢m...</span>
      </div>
    </div>
  </footer>
</div>
